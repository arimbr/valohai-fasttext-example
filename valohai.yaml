---

- step:
    name: autotune
    image: arimbr/valohai-fasttext-example
    command: python cli.py classification autotune {parameters}
    inputs:
      - name: train
        default: s3://valohai-fasttext-example/toxic_comments/train.txt
      - name: test
        default: s3://valohai-fasttext-example/toxic_comments/test.txt
    parameters:
     - name: metric
       description: metric objective {f1, f1:labelname} [f1]
       type: string
       default: f1
     - name: predictions
       description: number of predictions used for evaluation [1]
       type: integer
       default: 1
     - name: duration
       description: maximum duration in seconds [300]
       type: integer
       default: 300
     - name: model_size
       description: constraint model file size [] (empty = do not quantize)
       type: string
       default: ''

- step:
    name: predict
    image: arimbr/valohai-fasttext-example
    command: python cli.py classification predict {parameters}
    inputs:
      - name: test
        default: s3://valohai-fasttext-example/toxic_comments/test.txt
      - name: model
        default: s3://valohai-fasttext-example/toxic_comments/model.bin
    parameters:
     - name: k
       description: number of labels to predict [1]
       type: integer
       default: 1

- pipeline:
    name: autotune-predict-pipeline
    nodes:
      - name: autotune-node
        type: execution
        step: autotune
      - name: predict-node
        type: execution
        step: predict
    edges:
      - [autotune-node.output.model.bin, predict-node.input.model.bin]
