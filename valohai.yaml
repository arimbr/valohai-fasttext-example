---

- step:
    name: preprocess
    image: arimbr/valohai-fasttext-example
    command: python cli.py classification preprocess {parameters}
    inputs:
      - name: train
        default: s3://valohai-fasttext-example/toxic_comments/train.csv
    parameters:
     - name: feature
       type: string
       default: feature
     - name: category
       type: string
       default: category
     - name: separator
       type: string
       default: ','

- step:
    name: train
    image: arimbr/valohai-fasttext-example
    command: python cli.py classification train {parameters}
    inputs:
      - name: train_preprocessed
        default: s3://valohai-fasttext-example/toxic_comments/train_preprocessed.txt
    parameters:
     - name: lr
       type: float
       default: 0.01
     - name: minCount
       type: integer
       default: 2

- step:
    name: tune
    image: arimbr/valohai-fasttext-example
    command: python cli.py classification tune {parameters}
    inputs:
      - name: train_preprocessed
        default: s3://valohai-fasttext-example/toxic_comments/train_preprocessed.txt
      - name: test_preprocessed
        default: s3://valohai-fasttext-example/toxic_comments/test_preprocessed.txt
    parameters:
     - name: autotuneMetric
       type: string
       default: f1
     - name: autotuneDuration
       type: integer
       default: 3000

- step:
    name: test
    image: arimbr/valohai-fasttext-example
    command: python cli.py classification test {parameters}
    inputs:
      - name: test_preprocessed
        default: s3://valohai-fasttext-example/toxic_comments/test_preprocessed.txt
      - name: model
        default: s3://valohai-fasttext-example/toxic_comments/model.bin
    parameters:
     - name: k
       type: integer
       default: 1